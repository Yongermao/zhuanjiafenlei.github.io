<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>公共资源交易评标专家专业分类标准</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- 引入Excel处理库 -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36D399',
                        accent: '#FB8C00',
                        neutral: '#64748B',
                        'neutral-light': '#F1F5F9',
                        'neutral-dark': '#1E293B'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .tree-node {
                @apply py-1 px-2 hover:bg-neutral-light rounded transition-colors duration-200 cursor-pointer;
            }
            .tree-node-active {
                @apply bg-primary/10 text-primary font-medium;
            }
            .tree-node-collapsed {
                @apply hidden;
            }
            .stat-card {
                @apply bg-white rounded-lg shadow-md p-4 border-l-4 transition-all duration-300 hover:shadow-lg;
            }
            .btn {
                @apply px-4 py-2 rounded-lg font-medium transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2;
            }
            .btn-primary {
                @apply bg-primary text-white hover:bg-primary/90 focus:ring-primary/50;
            }
            .btn-success {
                @apply bg-secondary text-white hover:bg-secondary/90 focus:ring-secondary/50;
            }
            .btn-warning {
                @apply bg-accent text-white hover:bg-accent/90 focus:ring-accent/50;
            }
            .btn-neutral {
                @apply bg-neutral-light text-neutral-dark hover:bg-neutral hover:text-white focus:ring-neutral/50;
            }
            .drop-area {
                @apply border-2 border-dashed border-gray-300 rounded-lg p-8 text-center transition-all duration-300 hover:border-primary hover:bg-primary/5;
            }
        }
    </style>
</head>
<body class="font-inter bg-gray-50 min-h-screen">
    <!-- 顶部导航栏 -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <h1 class="text-xl font-bold text-neutral-dark">
                <i class="fa fa-sitemap mr-2 text-primary"></i>
                公共资源交易评标专家专业分类标准
            </h1>
            <div class="flex space-x-2">
                <!-- 隐藏的按钮：导入、导出、保存、重新初始化 -->
                <button class="btn btn-primary hidden-button" id="importBtn">
                    <i class="fa fa-upload mr-1"></i>导入
                </button>
                <button class="btn btn-success hidden-button" id="exportBtn">
                    <i class="fa fa-download mr-1"></i>导出
                </button>
                <button class="btn btn-neutral hidden-button" id="saveBtn">
                    <i class="fa fa-save mr-1"></i>保存
                </button>
                <!-- 显示的按钮：全部展开、全部折叠 -->
                <button class="btn btn-neutral" id="expandAllBtn">
                    <i class="fa fa-plus-square mr-1"></i>全部展开
                </button>
                <button class="btn btn-neutral" id="collapseAllBtn">
                    <i class="fa fa-minus-square mr-1"></i>全部折叠
                </button>
                <button class="btn btn-warning hidden-button" id="reinitBtn">
                    <i class="fa fa-refresh mr-1"></i>重新初始化
                </button>
            </div>
        </div>
    </header>

    <!-- 主内容区域 -->
    <main class="container mx-auto px-4 py-6">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- 左侧：专业分类树状结构 -->
            <div class="lg:col-span-2 bg-white rounded-lg shadow-md p-4">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold text-neutral-dark">
                        <i class="fa fa-folder-open mr-2 text-primary"></i>
                        专业分类树状结构
                    </h2>
                    <div class="relative">
                        <input type="text" 
                               placeholder="搜索分类..." 
                               class="pl-8 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary"
                               id="searchInput">
                        <i class="fa fa-search absolute left-3 top-3 text-gray-400"></i>
                    </div>
                </div>
                
                <!-- 拖放上传区域 -->
                <div class="drop-area mb-4" id="dropArea">
                    <i class="fa fa-cloud-upload text-4xl text-gray-400 mb-3"></i>
                    <p class="text-gray-600">拖放Excel或JSON文件到此处导入</p>
                    <p class="text-sm text-gray-500 mt-2">支持 .xlsx, .xls, .json 格式</p>
                </div>
                
                <div class="max-h-[calc(100vh-300px)] overflow-y-auto" id="classificationTree">
                    <!-- 分类树将通过JavaScript动态生成 -->
                    <div class="text-center py-10 text-gray-500" id="emptyState">
                        <i class="fa fa-folder-open-o text-4xl mb-4"></i>
                        <p>暂无分类数据</p>
                        <p class="text-sm mt-2">请拖放文件导入专家分类数据</p>
                    </div>
                </div>
            </div>
            
            <!-- 右侧：统计和信息面板 -->
            <div class="space-y-6">
                <!-- 分类统计 -->
                <div class="bg-white rounded-lg shadow-md p-4">
                    <h2 class="text-lg font-semibold text-neutral-dark mb-4">
                        <i class="fa fa-bar-chart mr-2 text-primary"></i>
                        分类统计
                    </h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="stat-card border-primary">
                            <div class="text-2xl font-bold text-primary" id="totalCount">0</div>
                            <div class="text-sm text-gray-600">总分类数</div>
                        </div>
                        <div class="stat-card border-secondary">
                            <div class="text-2xl font-bold text-secondary" id="engineerCount">0</div>
                            <div class="text-sm text-gray-600">工程类</div>
                        </div>
                        <div class="stat-card border-accent">
                            <div class="text-2xl font-bold text-accent" id="goodsCount">0</div>
                            <div class="text-sm text-gray-600">货物类</div>
                        </div>
                        <div class="stat-card border-neutral">
                            <div class="text-2xl font-bold text-neutral" id="serviceCount">0</div>
                            <div class="text-sm text-gray-600">服务类</div>
                        </div>
                    </div>
                    
                    <!-- 层级统计 -->
                    <div class="mt-6">
                        <h3 class="text-md font-medium text-neutral-dark mb-3">层级分布</h3>
                        <div class="space-y-2">
                            <div class="flex items-center">
                                <div class="w-24 text-sm text-gray-600">根目录</div>
                                <div class="flex-1 bg-gray-200 rounded-full h-2">
                                    <div class="bg-primary h-2 rounded-full" id="level1Bar" style="width: 0%"></div>
                                </div>
                                <div class="w-8 text-right text-sm font-medium" id="level1Count">0</div>
                            </div>
                            <div class="flex items-center">
                                <div class="w-24 text-sm text-gray-600">二级目录</div>
                                <div class="flex-1 bg-gray-200 rounded-full h-2">
                                    <div class="bg-secondary h-2 rounded-full" id="level2Bar" style="width: 0%"></div>
                                </div>
                                <div class="w-8 text-right text-sm font-medium" id="level2Count">0</div>
                            </div>
                            <div class="flex items-center">
                                <div class="w-24 text-sm text-gray-600">三级目录</div>
                                <div class="flex-1 bg-gray-200 rounded-full h-2">
                                    <div class="bg-accent h-2 rounded-full" id="level3Bar" style="width: 0%"></div>
                                </div>
                                <div class="w-8 text-right text-sm font-medium" id="level3Count">0</div>
                            </div>
                            <div class="flex items-center">
                                <div class="w-24 text-sm text-gray-600">四级目录</div>
                                <div class="flex-1 bg-gray-200 rounded-full h-2">
                                    <div class="bg-purple-500 h-2 rounded-full" id="level4Bar" style="width: 0%"></div>
                                </div>
                                <div class="w-8 text-right text-sm font-medium" id="level4Count">0</div>
                            </div>
                            <div class="flex items-center">
                                <div class="w-24 text-sm text-gray-600">五级目录</div>
                                <div class="flex-1 bg-gray-200 rounded-full h-2">
                                    <div class="bg-pink-500 h-2 rounded-full" id="level5Bar" style="width: 0%"></div>
                                </div>
                                <div class="w-8 text-right text-sm font-medium" id="level5Count">0</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 操作说明 -->
                <div class="bg-white rounded-lg shadow-md p-4">
                    <h2 class="text-lg font-semibold text-neutral-dark mb-4">
                        <i class="fa fa-info-circle mr-2 text-primary"></i>
                        操作说明
                    </h2>
                    <div class="text-sm text-gray-600 space-y-2" id="operationGuide">
                        <p>• 支持Excel (.xlsx, .xls) 和JSON (.json) 格式导入</p>
                        <p>• 可以拖放文件到上传区域</p>
                        <p>• Excel文件需包含：上级目录、目录级别、编码、目录名称、备注</p>
                        <p>• 数据导入后会自动保存到本地</p>
                        <p>• 使用"全部展开/折叠"按钮管理分类视图</p>
                    </div>
                </div>
                
                <!-- 版本信息 -->
                <div class="bg-white rounded-lg shadow-md p-4">
                    <h2 class="text-lg font-semibold text-neutral-dark mb-4">
                        <i class="fa fa-code-fork mr-2 text-primary"></i>
                        版本信息
                    </h2>
                    <div class="text-sm text-gray-600 space-y-2">
                        <p><strong>版本号：</strong>1201V9</p>
                        <p><strong>更新时间：</strong>2025-12-04</p>
                        <p><strong>更新内容：</strong>隐藏导入、导出、保存、重新初始化按钮</p>
                        <p><strong>数据状态：</strong><span id="dataStatus">未加载</span></p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 底部信息栏 -->
    <footer class="bg-neutral-dark text-white py-4 mt-8">
        <div class="container mx-auto px-4 text-center text-sm">
            <p>公共资源交易评标专家专业分类标准管理系统 © 2025</p>
            <p class="mt-1 text-gray-400">支持Excel和JSON格式数据导入，本地数据安全保护</p>
        </div>
    </footer>

    <!-- 文件输入控件（隐藏） -->
    <input type="file" id="fileInput" accept=".json,.xlsx,.xls" style="display: none;">

    <!-- JavaScript功能 -->
    <script>
        // 全局变量
        let classificationData = null;
        let savedFileData = null;
        
        // DOM元素
        const importBtn = document.getElementById('importBtn');
        const exportBtn = document.getElementById('exportBtn');
        const saveBtn = document.getElementById('saveBtn');
        const expandAllBtn = document.getElementById('expandAllBtn');
        const collapseAllBtn = document.getElementById('collapseAllBtn');
        const reinitBtn = document.getElementById('reinitBtn');
        const searchInput = document.getElementById('searchInput');
        const fileInput = document.getElementById('fileInput');
        const classificationTree = document.getElementById('classificationTree');
        const emptyState = document.getElementById('emptyState');
        const dropArea = document.getElementById('dropArea');
        
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            // 检查本地存储
            checkLocalStorage();
            
            // 绑定事件
            bindEvents();
            
            // 初始化拖放功能
            initDragAndDrop();
            
            // 显示页面加载完成提示
            showToast('系统加载完成，支持Excel和JSON格式数据导入');
        });
        
        // 检查本地存储
        function checkLocalStorage() {
            const savedData = localStorage.getItem('classificationData');
            const savedFile = localStorage.getItem('classificationFile');
            
            if (savedData) {
                try {
                    classificationData = JSON.parse(savedData);
                    document.getElementById('dataStatus').textContent = '已加载本地数据';
                    renderClassificationTree();
                    updateStatistics();
                    showToast('已加载本地保存的分类数据');
                } catch (e) {
                    console.error('解析本地数据失败:', e);
                    document.getElementById('dataStatus').textContent = '本地数据损坏';
                }
            } else if (savedFile) {
                document.getElementById('dataStatus').textContent = '有保存的文件数据';
                showToast('检测到保存的文件数据，请拖放文件导入');
            } else {
                document.getElementById('dataStatus').textContent = '未加载数据';
                showToast('首次使用，请拖放文件导入专家分类数据');
            }
        }
        
        // 绑定事件
        function bindEvents() {
            // 导入按钮（隐藏但功能保留）
            importBtn.addEventListener('click', function() {
                fileInput.click();
            });
            
            // 文件选择
            fileInput.addEventListener('change', handleFileImport);
            
            // 导出按钮（隐藏但功能保留）
            exportBtn.addEventListener('click', exportData);
            
            // 保存按钮（隐藏但功能保留）
            saveBtn.addEventListener('click', saveDataToLocal);
            
            // 全部展开
            expandAllBtn.addEventListener('click', expandAll);
            
            // 全部折叠
            collapseAllBtn.addEventListener('click', collapseAll);
            
            // 重新初始化（隐藏但功能保留）
            reinitBtn.addEventListener('click', reinitializeSystem);
            
            // 搜索功能
            searchInput.addEventListener('input', function() {
                searchClassification(this.value);
            });
        }
        
        // 初始化拖放功能
        function initDragAndDrop() {
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                dropArea.classList.add('bg-primary/10', 'border-primary');
            }
            
            function unhighlight() {
                dropArea.classList.remove('bg-primary/10', 'border-primary');
            }
            
            dropArea.addEventListener('drop', handleDrop, false);
        }
        
        // 处理拖放文件
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            if (files.length > 0) {
                handleFiles(files);
            }
        }
        
        // 处理文件选择
        function handleFileImport(event) {
            const files = event.target.files;
            if (files.length > 0) {
                handleFiles(files);
            }
        }
        
        // 处理文件
        function handleFiles(files) {
            const file = files[0];
            if (!file) return;
            
            const fileExtension = file.name.split('.').pop().toLowerCase();
            
            if (fileExtension === 'json') {
                handleJSONFile(file);
            } else if (['xlsx', 'xls'].includes(fileExtension)) {
                handleExcelFile(file);
            } else {
                showToast(`不支持的文件格式: .${fileExtension}`, 'error');
            }
        }
        
        // 处理JSON文件
        function handleJSONFile(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    processImportedData(data, 'JSON');
                } catch (e) {
                    showToast('JSON文件解析失败，请检查文件格式', 'error');
                    console.error('JSON解析失败:', e);
                }
            };
            
            reader.readAsText(file);
        }
        
        // 处理Excel文件
        function handleExcelFile(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // 假设第一个工作表包含数据
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // 转换为JSON
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    // 处理Excel数据
                    const processedData = processExcelData(jsonData);
                    
                    processImportedData(processedData, 'Excel');
                    
                } catch (e) {
                    showToast('Excel文件解析失败，请检查文件格式', 'error');
                    console.error('Excel解析失败:', e);
                }
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // 处理Excel数据
        function processExcelData(excelData) {
            if (!excelData || excelData.length === 0) {
                return [];
            }
            
            // 定义标准列名映射
            const columnMapping = {
                '上级目录': 'parent_code',
                '目录级别': 'level',
                '编码': 'code',
                '目录名称': 'name',
                '备注': 'remark'
            };
            
            // 检查列名
            const excelColumns = Object.keys(excelData[0]);
            const missingColumns = [];
            
            Object.keys(columnMapping).forEach(key => {
                if (!excelColumns.includes(key)) {
                    missingColumns.push(key);
                }
            });
            
            if (missingColumns.length > 0) {
                showToast(`Excel文件缺少必要的列: ${missingColumns.join(', ')}`, 'warning');
            }
            
            // 转换数据格式
            return excelData.map(row => {
                const item = {};
                
                Object.keys(columnMapping).forEach(key => {
                    const value = row[key];
                    item[columnMapping[key]] = value !== undefined ? value : '';
                });
                
                // 确保level是数字类型
                if (item.level && typeof item.level === 'string') {
                    item.level = parseInt(item.level, 10) || 1;
                }
                
                return item;
            });
        }
        
        // 处理导入的数据
        function processImportedData(data, sourceType) {
            if (!data || data.length === 0) {
                showToast('导入的数据为空', 'warning');
                return;
            }
            
            // 验证数据格式
            if (!validateDataFormat(data)) {
                showToast('导入的数据格式不正确', 'error');
                return;
            }
            
            classificationData = data;
            
            // 保存到本地存储
            localStorage.setItem('classificationData', JSON.stringify(data));
            localStorage.setItem('lastImportTime', new Date().toISOString());
            localStorage.setItem('lastImportSource', sourceType);
            
            // 渲染分类树
            renderClassificationTree();
            updateStatistics();
            
            // 更新状态
            document.getElementById('dataStatus').textContent = `已导入${sourceType}数据`;
            showToast(`成功导入 ${data.length} 条分类数据 (来源: ${sourceType})`);
            
            // 重置文件输入
            fileInput.value = '';
        }
        
        // 验证数据格式
        function validateDataFormat(data) {
            if (!Array.isArray(data)) return false;
            
            const requiredFields = ['parent_code', 'level', 'code', 'name'];
            
            return data.every(item => {
                return requiredFields.every(field => {
                    return item.hasOwnProperty(field) && item[field] !== undefined;
                });
            });
        }
        
        // 导出数据
        function exportData() {
            if (!classificationData || classificationData.length === 0) {
                showToast('没有可导出的数据', 'warning');
                return;
            }
            
            // 询问用户导出格式
            const format = prompt('请选择导出格式：\n1. JSON\n2. Excel', '1');
            
            if (format === null) return;
            
            if (format === '1' || format === 'JSON') {
                exportAsJSON();
            } else if (format === '2' || format === 'Excel') {
                exportAsExcel();
            } else {
                showToast('无效的格式选择', 'warning');
            }
        }
        
        // 导出为JSON
        function exportAsJSON() {
            const dataStr = JSON.stringify(classificationData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `专家分类数据_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            URL.revokeObjectURL(url);
            showToast('数据已导出为JSON文件');
        }
        
        // 导出为Excel
        function exportAsExcel() {
            // 转换数据格式
            const excelData = classificationData.map(item => {
                return {
                    '上级目录': item.parent_code || '',
                    '目录级别': item.level || '',
                    '编码': item.code || '',
                    '目录名称': item.name || '',
                    '备注': item.remark || ''
                };
            });
            
            // 创建工作簿和工作表
            const ws = XLSX.utils.json_to_sheet(excelData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "专家分类数据");
            
            // 导出文件
            XLSX.writeFile(wb, `专家分类数据_${new Date().toISOString().slice(0, 10)}.xlsx`);
            
            showToast('数据已导出为Excel文件');
        }
        
        // 保存数据到本地
        function saveDataToLocal() {
            if (!classificationData || classificationData.length === 0) {
                showToast('没有可保存的数据', 'warning');
                return;
            }
            
            // 更新本地存储
            localStorage.setItem('classificationData', JSON.stringify(classificationData));
            localStorage.setItem('lastSaveTime', new Date().toISOString());
            
            // 也可以选择保存到文件
            const dataStr = JSON.stringify(classificationData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `专家分类数据_本地保存_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            URL.revokeObjectURL(url);
            
            showToast('数据已保存到本地存储和文件系统');
        }
        
        // 展开所有节点
        function expandAll() {
            const nodes = document.querySelectorAll('.tree-node');
            nodes.forEach(node => {
                node.classList.remove('tree-node-collapsed');
            });
            showToast('已展开所有分类节点');
        }
        
        // 折叠所有节点
        function collapseAll() {
            const nodes = document.querySelectorAll('.tree-node');
            nodes.forEach(node => {
                if (!node.closest('.pl-4')) {
                    return; // 保留根节点
                }
                node.classList.add('tree-node-collapsed');
            });
            showToast('已折叠所有分类节点');
        }
        
        // 重新初始化系统
        function reinitializeSystem() {
            if (confirm('确定要重新初始化系统吗？这将清除所有已导入的数据！')) {
                // 清除本地存储
                localStorage.removeItem('classificationData');
                localStorage.removeItem('lastImportTime');
                localStorage.removeItem('lastImportSource');
                localStorage.removeItem('lastSaveTime');
                
                // 重置数据
                classificationData = null;
                savedFileData = null;
                
                // 重新渲染
                renderClassificationTree();
                updateStatistics();
                
                // 更新状态
                document.getElementById('dataStatus').textContent = '已初始化';
                showToast('系统已重新初始化，请重新导入数据');
            }
        }
        
        // 搜索分类
        function searchClassification(keyword) {
            const nodes = document.querySelectorAll('.tree-node');
            nodes.forEach(node => {
                const text = node.textContent.toLowerCase();
                if (text.includes(keyword.toLowerCase())) {
                    node.style.display = 'block';
                    node.classList.add('tree-node-active');
                } else {
                    node.style.display = 'none';
                    node.classList.remove('tree-node-active');
                }
            });
        }
        
        // 渲染分类树
        function renderClassificationTree() {
            if (!classificationData || classificationData.length === 0) {
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            // 清空现有内容
            classificationTree.innerHTML = '';
            
            // 构建树形结构
            const treeContainer = document.createElement('div');
            
            // 按层级分组
            const levelGroups = {};
            classificationData.forEach(item => {
                const level = item.level || 1;
                if (!levelGroups[level]) {
                    levelGroups[level] = [];
                }
                levelGroups[level].push(item);
            });
            
            // 递归构建树
            function buildTree(level, parentCode = 'root') {
                const items = levelGroups[level] || [];
                const filteredItems = items.filter(item => item.parent_code === parentCode);
                
                if (filteredItems.length === 0) return null;
                
                const levelContainer = document.createElement('div');
                levelContainer.className = `pl-${(level - 1) * 4} mt-1`;
                
                filteredItems.forEach(item => {
                    const node = document.createElement('div');
                    node.className = 'tree-node';
                    node.dataset.code = item.code;
                    node.dataset.level = item.level;
                    
                    const iconClass = item.level < 5 ? 'fa-folder text-primary' : 'fa-file-text-o text-gray-500';
                    
                    node.innerHTML = `
                        <i class="fa ${iconClass} mr-2"></i>
                        <span>[${item.code}] ${item.name}</span>
                        ${item.remark ? `<span class="ml-2 text-xs bg-gray-100 text-gray-600 px-1 py-0.5 rounded">${item.remark}</span>` : ''}
                    `;
                    
                    // 点击事件
                    node.addEventListener('click', function(e) {
                        e.stopPropagation();
                        
                        // 切换激活状态
                        this.classList.toggle('tree-node-active');
                        
                        // 找到下一个兄弟节点（子节点容器）
                        let nextSibling = this.nextElementSibling;
                        while (nextSibling && !nextSibling.classList.contains(`pl-${level * 4}`)) {
                            nextSibling = nextSibling.nextElementSibling;
                        }
                        
                        // 切换显示/隐藏
                        if (nextSibling) {
                            if (nextSibling.style.display === 'none') {
                                nextSibling.style.display = 'block';
                            } else {
                                nextSibling.style.display = 'none';
                            }
                        }
                    });
                    
                    levelContainer.appendChild(node);
                    
                    // 递归构建子节点
                    const childTree = buildTree(level + 1, item.code);
                    if (childTree) {
                        levelContainer.appendChild(childTree);
                    }
                });
                
                return levelContainer;
            }
            
            // 从根节点开始构建
            const rootTree = buildTree(1);
            if (rootTree) {
                treeContainer.appendChild(rootTree);
            }
            
            classificationTree.appendChild(treeContainer);
        }
        
        // 更新统计信息
        function updateStatistics() {
            if (!classificationData || classificationData.length === 0) {
                document.getElementById('totalCount').textContent = '0';
                document.getElementById('engineerCount').textContent = '0';
                document.getElementById('goodsCount').textContent = '0';
                document.getElementById('serviceCount').textContent = '0';
                
                for (let i = 1; i <= 5; i++) {
                    document.getElementById(`level${i}Count`).textContent = '0';
                    document.getElementById(`level${i}Bar`).style.width = '0%';
                }
                
                return;
            }
            
            // 总统计
            const total = classificationData.length;
            document.getElementById('totalCount').textContent = total;
            
            // 类别统计
            const engineerCount = classificationData.filter(item => item.code.startsWith('A')).length;
            const goodsCount = classificationData.filter(item => item.code.startsWith('B')).length;
            const serviceCount = classificationData.filter(item => item.code.startsWith('C')).length;
            
            document.getElementById('engineerCount').textContent = engineerCount;
            document.getElementById('goodsCount').textContent = goodsCount;
            document.getElementById('serviceCount').textContent = serviceCount;
            
            // 层级统计
            for (let i = 1; i <= 5; i++) {
                const count = classificationData.filter(item => item.level === i).length;
                const percentage = total > 0 ? Math.min(100, (count / total) * 100) : 0;
                
                document.getElementById(`level${i}Count`).textContent = count;
                document.getElementById(`level${i}Bar`).style.width = `${percentage}%`;
            }
        }
        
        // 显示提示消息
        function showToast(message, type = 'success') {
            // 创建toast元素
            const toast = document.createElement('div');
            toast.className = `fixed bottom-4 right-4 px-4 py-2 rounded-lg shadow-lg z-50 transition-all duration-300 transform translate-y-0 opacity-100`;
            
            // 根据类型设置样式
            if (type === 'success') {
                toast.classList.add('bg-green-500', 'text-white');
            } else if (type === 'warning') {
                toast.classList.add('bg-yellow-500', 'text-white');
            } else if (type === 'error') {
                toast.classList.add('bg-red-500', 'text-white');
            } else {
                toast.classList.add('bg-primary', 'text-white');
            }
            
            toast.textContent = message;
            
            // 添加到页面
            document.body.appendChild(toast);
            
            // 3秒后自动消失
            setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-y-4');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>
